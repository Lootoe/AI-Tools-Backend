// Prisma Schema for AI Tools
// 使用 PostgreSQL 数据库

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 剧本
model Script {
  id           String      @id @default(cuid())
  title        String
  prompt       String?     // 生成剧本的提示词
  content      String?     // 剧本内容
  currentPhase String      @default("storyboard") // storyboard | video
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  episodes     Episode[]
  characters   Character[]

  @@map("scripts")
}

// 剧集
model Episode {
  id            String   @id @default(cuid())
  scriptId      String
  episodeNumber Int
  title         String
  content       String   // 剧集内容
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  script      Script       @relation(fields: [scriptId], references: [id], onDelete: Cascade)
  storyboards Storyboard[]

  @@map("episodes")
}

// 分镜
model Storyboard {
  id                 String   @id @default(cuid())
  episodeId          String
  sceneNumber        Int
  description        String
  referenceImageUrls String[] // 参考图URL数组
  aspectRatio        String?  @default("16:9") // 16:9 | 9:16
  duration           String?  @default("10") // 10 | 15
  activeVariantId    String?  // 当前选中的副本ID
  createdAt          DateTime @default(now())
  // 兼容旧数据
  videoUrl           String?
  thumbnailUrl       String?
  taskId             String?
  progress           String?
  status             String   @default("pending")

  episode  Episode             @relation(fields: [episodeId], references: [id], onDelete: Cascade)
  variants StoryboardVariant[]

  @@map("storyboards")
}

// 分镜副本
model StoryboardVariant {
  id           String   @id @default(cuid())
  storyboardId String
  videoUrl     String?
  thumbnailUrl String?
  taskId       String?
  progress     String?
  status       String   @default("pending") // pending | queued | generating | completed | failed
  createdAt    DateTime @default(now())

  storyboard Storyboard @relation(fields: [storyboardId], references: [id], onDelete: Cascade)

  @@map("storyboard_variants")
}


// 角色资产
model Character {
  id             String   @id @default(cuid())
  scriptId       String
  name           String
  description    String   // 角色设定/信息
  designImageUrl String?  // 角色设计稿图片URL
  thumbnailUrl   String?  // 缩略图
  status         String   @default("pending") // pending | generating | completed | failed
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  script Script @relation(fields: [scriptId], references: [id], onDelete: Cascade)

  @@map("characters")
}
